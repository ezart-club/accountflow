<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AccountFlow - Professional Accounting Software</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            color: #334155;
        }

        .header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tabs {
            display: flex;
            gap: 2rem;
            margin-left: 3rem;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.8;
        }

        .nav-tab:hover, .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
            opacity: 1;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .icon-blue { background: #dbeafe; color: #1e40af; }
        .icon-green { background: #dcfce7; color: #166534; }
        .icon-purple { background: #f3e8ff; color: #7c3aed; }
        .icon-orange { background: #fed7aa; color: #ea580c; }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .change-positive { color: #059669; }
        .change-negative { color: #dc2626; }

        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .table-header {
            background: #f8fafc;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        tr:hover {
            background: #f8fafc;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .status-paid { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #d97706; }
        .status-accepted { background: #dcfce7; color: #166534; }
        .status-expired { background: #fee2e2; color: #dc2626; }
        .status-converted { background: #e0e7ff; color: #3730a3; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 5% auto;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .modal-header {
            padding: 1.5rem;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .close-btn:hover {
            background: #f3f4f6;
        }

        .google-sheets-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                margin-left: 0;
                flex-wrap: wrap;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .main-container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                AccountFlow
            </div>
            <nav class="nav-tabs">
                <div class="nav-tab active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </div>
                <div class="nav-tab" onclick="showSection('invoices')">
                    <i class="fas fa-file-invoice"></i> Invoices
                </div>
                <div class="nav-tab" onclick="showSection('expenses')">
                    <i class="fas fa-receipt"></i> Expenses
                </div>
                <div class="nav-tab" onclick="showSection('quotations')">
                    <i class="fas fa-file-alt"></i> Quotations
                </div>
                <div class="nav-tab" onclick="showSection('contacts')">
                    <i class="fas fa-users"></i> Contacts
                </div>
                <div class="nav-tab" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i> Reports
                </div>
            </nav>
        </div>
    </header>

    <main class="main-container">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Total Revenue</div>
                        <div class="card-icon icon-blue">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="metric-value">$45,231</div>
                    <div class="metric-change change-positive">
                        <i class="fas fa-arrow-up"></i>
                        +12.5% from last month
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Outstanding Invoices</div>
                        <div class="card-icon icon-orange">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="metric-value">$8,492</div>
                    <div class="metric-change change-negative">
                        <i class="fas fa-arrow-down"></i>
                        3 overdue invoices
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Monthly Expenses</div>
                        <div class="card-icon icon-purple">
                            <i class="fas fa-credit-card"></i>
                        </div>
                    </div>
                    <div class="metric-value">$12,847</div>
                    <div class="metric-change change-positive">
                        <i class="fas fa-arrow-up"></i>
                        -8.2% from last month
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Net Profit</div>
                        <div class="card-icon icon-green">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="metric-value">$32,384</div>
                    <div class="metric-change change-positive">
                        <i class="fas fa-arrow-up"></i>
                        +18.7% profit margin
                    </div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">Recent Transactions</div>
                    <button class="btn btn-secondary" onclick="syncWithSheets()">
                        <i class="fas fa-sync"></i> Sync with Sheets
                    </button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Contact</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTable">
                        <tr>
                            <td>2025-01-28</td>
                            <td>Web Development Services</td>
                            <td>Acme Corp</td>
                            <td>$2,500.00</td>
                            <td><span class="status-badge status-paid">Paid</span></td>
                        </tr>
                        <tr>
                            <td>2025-01-27</td>
                            <td>Office Supplies</td>
                            <td>Office Depot</td>
                            <td>-$234.50</td>
                            <td><span class="status-badge status-pending">Pending</span></td>
                        </tr>
                        <tr>
                            <td>2025-01-26</td>
                            <td>Consulting Services</td>
                            <td>Tech Solutions Inc</td>
                            <td>$1,800.00</td>
                            <td><span class="status-badge status-overdue">Overdue</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Invoices Section -->
        <div id="invoices" class="section" style="display: none;">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">Invoices</div>
                    <button class="btn btn-primary" onclick="openModal('invoiceModal')">
                        <i class="fas fa-plus"></i> New Invoice
                    </button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Client</th>
                            <th>Date</th>
                            <th>Due Date</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="invoicesTable">
                        <!-- Invoice data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quotations Section -->
        <div id="quotations" class="section" style="display: none;">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">Quotations</div>
                    <button class="btn btn-primary" onclick="openModal('quotationModal')">
                        <i class="fas fa-plus"></i> New Quotation
                    </button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Quote #</th>
                            <th>Client</th>
                            <th>Date</th>
                            <th>Valid Until</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="quotationsTable">
                        <!-- Quotation data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Other sections would be implemented similarly -->
        <!-- Expenses Section -->
        <div id="expenses" class="section" style="display: none;">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">Expenses</div>
                    <button class="btn btn-primary" onclick="openModal('expenseModal')">
                        <i class="fas fa-plus"></i> New Expense
                    </button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Receipt</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTable">
                        <!-- Expense data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="contacts" class="section" style="display: none;">
            <h2>Contacts - Coming Soon</h2>
            <p>This section will show customer and vendor management.</p>
        </div>

        <div id="reports" class="section" style="display: none;">
            <h2>Reports - Coming Soon</h2>
            <p>This section will show financial reports and analytics.</p>
        </div>
    </main>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Expense</h3>
                <button class="close-btn" onclick="closeModal('expenseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="expenseForm">
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-input" id="expenseDescription" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" class="form-input" id="expenseAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-input" id="expenseCategory" required>
                            <option value="">Select Category</option>
                            <option value="office-supplies">Office Supplies</option>
                            <option value="software">Software</option>
                            <option value="travel">Travel</option>
                            <option value="meals">Meals & Entertainment</option>
                            <option value="utilities">Utilities</option>
                            <option value="marketing">Marketing</option>
                            <option value="professional-services">Professional Services</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="expenseDate" required>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('expenseModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Expense</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quotation Modal -->
    <div id="quotationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Quotation</h3>
                <button class="close-btn" onclick="closeModal('quotationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="quotationForm">
                    <div class="form-group">
                        <label class="form-label">Client Name</label>
                        <input type="text" class="form-input" id="quoteClientName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quotation Amount</label>
                        <input type="number" class="form-input" id="quotationAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-input" id="quotationDescription" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valid Until</label>
                        <input type="date" class="form-input" id="validUntil" required>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('quotationModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Quotation</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Invoice</h3>
                <button class="close-btn" onclick="closeModal('invoiceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="invoiceForm">
                    <div class="form-group">
                        <label class="form-label">Client Name</label>
                        <input type="text" class="form-input" id="clientName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Invoice Amount</label>
                        <input type="number" class="form-input" id="invoiceAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-input" id="invoiceDescription" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" class="form-input" id="dueDate" required>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('invoiceModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Invoice</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Google Sheets Status Indicator -->
    <div class="google-sheets-status">
        <div class="status-indicator"></div>
        Connected to Google Sheets
    </div>

    <script>
        // Sample data structure that would sync with Google Sheets
        let accountingData = {
            quotations: [
                { id: 'QUO-001', client: 'New Client Corp', date: '2025-01-28', validUntil: '2025-02-28', amount: 4500, status: 'pending' },
                { id: 'QUO-002', client: 'Future Tech Ltd', date: '2025-01-27', validUntil: '2025-02-27', amount: 3200, status: 'accepted' },
                { id: 'QUO-003', client: 'Innovation Hub', date: '2025-01-25', validUntil: '2025-02-15', amount: 2800, status: 'expired' }
            ],
            invoices: [
                { id: 'INV-001', client: 'Acme Corp', date: '2025-01-28', dueDate: '2025-02-28', amount: 2500, status: 'paid' },
                { id: 'INV-002', client: 'Tech Solutions Inc', date: '2025-01-26', dueDate: '2025-01-25', amount: 1800, status: 'overdue' },
                { id: 'INV-003', client: 'StartupXYZ', date: '2025-01-25', dueDate: '2025-02-25', amount: 3200, status: 'pending' }
            ],
            expenses: [
                { id: 'EXP-001', description: 'Office Supplies - Pens & Paper', category: 'office-supplies', amount: 89.50, date: '2025-01-28', receipt: true },
                { id: 'EXP-002', description: 'Software License - Adobe Creative', category: 'software', amount: 52.99, date: '2025-01-27', receipt: false },
                { id: 'EXP-003', description: 'Business Lunch Meeting', category: 'meals', amount: 125.00, date: '2025-01-26', receipt: true }
            ],
            contacts: [],
            transactions: []
        };

        // Navigation functions
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.style.display = 'none');
            
            // Show selected section
            document.getElementById(sectionName).style.display = 'block';
            
            // Update active tab
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.closest('.nav-tab').classList.add('active');
            
            // Load section-specific data
            if (sectionName === 'invoices') {
                loadInvoices();
            } else if (sectionName === 'quotations') {
                loadQuotations();
            } else if (sectionName === 'expenses') {
                loadExpenses();
            }
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Load expenses into table
        function loadExpenses() {
            const tbody = document.getElementById('expensesTable');
            tbody.innerHTML = '';
            
            accountingData.expenses.forEach(expense => {
                const row = tbody.insertRow();
                const categoryFormatted = expense.category.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                row.innerHTML = `
                    <td>${expense.date}</td>
                    <td>${expense.description}</td>
                    <td>${categoryFormatted}</td>
                    <td>${expense.amount.toFixed(2)}</td>
                    <td>${expense.receipt ? '<i class="fas fa-check" style="color: #059669;"></i>' : '<i class="fas fa-times" style="color: #dc2626;"></i>'}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editExpense('${expense.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
            });
        }

        // Handle expense form submission
        document.getElementById('expenseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newExpense = {
                id: 'EXP-' + String(accountingData.expenses.length + 1).padStart(3, '0'),
                description: document.getElementById('expenseDescription').value,
                category: document.getElementById('expenseCategory').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                date: document.getElementById('expenseDate').value,
                receipt: false // In real app, this would be based on file upload
            };
            
            // Add to local data
            accountingData.expenses.push(newExpense);
            
            // Refresh the expenses table
            loadExpenses();
            
            // Close modal and reset form
            closeModal('expenseModal');
            this.reset();
            
            // Show success message
            alert('Expense added successfully!');
            
            // Sync with Google Sheets
            addExpenseToSheet(newExpense);
        });

        // Load quotations into table
        function loadQuotations() {
            const tbody = document.getElementById('quotationsTable');
            tbody.innerHTML = '';
            
            accountingData.quotations.forEach(quotation => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${quotation.id}</td>
                    <td>${quotation.client}</td>
                    <td>${quotation.date}</td>
                    <td>${quotation.validUntil}</td>
                    <td>${quotation.amount.toFixed(2)}</td>
                    <td><span class="status-badge status-${quotation.status}">${quotation.status}</span></td>
                    <td>
                        <button class="btn btn-secondary" onclick="convertToInvoice('${quotation.id}')">
                            <i class="fas fa-file-invoice"></i> Convert
                        </button>
                        <button class="btn btn-secondary" onclick="editQuotation('${quotation.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
            });
        }

        // Load invoices into table
        function loadInvoices() {
            const tbody = document.getElementById('invoicesTable');
            tbody.innerHTML = '';
            
            accountingData.invoices.forEach(invoice => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${invoice.id}</td>
                    <td>${invoice.client}</td>
                    <td>${invoice.date}</td>
                    <td>${invoice.dueDate}</td>
                    <td>$${invoice.amount.toFixed(2)}</td>
                    <td><span class="status-badge status-${invoice.status}">${invoice.status}</span></td>
                    <td>
                        <button class="btn btn-secondary" onclick="editInvoice('${invoice.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
            });
        }

        // Convert quotation to invoice
        function convertToInvoice(quotationId) {
            const quotation = accountingData.quotations.find(q => q.id === quotationId);
            if (quotation && quotation.status === 'accepted') {
                const newInvoice = {
                    id: 'INV-' + String(accountingData.invoices.length + 1).padStart(3, '0'),
                    client: quotation.client,
                    date: new Date().toISOString().split('T')[0],
                    dueDate: new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0], // 30 days from now
                    amount: quotation.amount,
                    status: 'pending'
                };
                
                accountingData.invoices.push(newInvoice);
                quotation.status = 'converted';
                
                alert(`Quotation ${quotationId} converted to Invoice ${newInvoice.id}!`);
                loadQuotations();
                syncWithSheets();
            } else {
                alert('Only accepted quotations can be converted to invoices.');
            }
        }

        // Handle quotation form submission
        document.getElementById('quotationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newQuotation = {
                id: 'QUO-' + String(accountingData.quotations.length + 1).padStart(3, '0'),
                client: document.getElementById('quoteClientName').value,
                date: new Date().toISOString().split('T')[0],
                validUntil: document.getElementById('validUntil').value,
                amount: parseFloat(document.getElementById('quotationAmount').value),
                status: 'pending'
            };
            
            // Add to local data
            accountingData.quotations.push(newQuotation);
            
            // Refresh the quotations table
            loadQuotations();
            
            // Close modal and reset form
            closeModal('quotationModal');
            this.reset();
            
            // Show success message
            alert('Quotation created successfully!');
            
            // Sync with Google Sheets
            addQuotationToSheet(newQuotation);
        });

        // Handle invoice form submission
        document.getElementById('invoiceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newInvoice = {
                id: 'INV-' + String(accountingData.invoices.length + 1).padStart(3, '0'),
                client: document.getElementById('clientName').value,
                date: new Date().toISOString().split('T')[0],
                dueDate: document.getElementById('dueDate').value,
                amount: parseFloat(document.getElementById('invoiceAmount').value),
                status: 'pending'
            };
            
            // Add to local data (in real implementation, this would sync to Google Sheets)
            accountingData.invoices.push(newInvoice);
            
            // Refresh the invoices table
            loadInvoices();
            
            // Close modal and reset form
            closeModal('invoiceModal');
            this.reset();
            
            // Show success message
            alert('Invoice created successfully! In production, this would sync to your Google Sheets.');
            
            // Sync with Google Sheets
            addInvoiceToSheet(newInvoice);
        });

        // ðŸ”§ STEP 4: REPLACE THIS URL WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        // After deploying your Google Apps Script, copy the web app URL here:
        const GOOGLE_APPS_SCRIPT_URL = 'YOUR_WEB_APP_URL_HERE'; // â† PASTE YOUR WEB APP URL HERE

        // Generic function to call Google Apps Script
        async function callGoogleScript(action, data = {}) {
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action, ...data })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Google Apps Script call failed:', error);
                throw error;
            }
        }

        // Add invoice to Google Sheets
        async function addInvoiceToSheet(invoice) {
            try {
                await callGoogleScript('addInvoice', invoice);
                console.log('Invoice synced to Google Sheets');
            } catch (error) {
                console.error('Failed to sync invoice:', error);
            }
        }

        // Add quotation to Google Sheets
        async function addQuotationToSheet(quotation) {
            try {
                await callGoogleScript('addQuotation', quotation);
                console.log('Quotation synced to Google Sheets');
            } catch (error) {
                console.error('Failed to sync quotation:', error);
            }
        }

        // Add expense to Google Sheets
        async function addExpenseToSheet(expense) {
            try {
                await callGoogleScript('addExpense', expense);
                console.log('Expense synced to Google Sheets');
            } catch (error) {
                console.error('Failed to sync expense:', error);
            }
        }

        // Load all data from Google Sheets
        async function loadFromGoogleSheets() {
            try {
                const [invoices, quotations, expenses] = await Promise.all([
                    callGoogleScript('getInvoices'),
                    callGoogleScript('getQuotations'),
                    callGoogleScript('getExpenses')
                ]);

                // Update local data
                if (invoices && invoices.length > 1) { // Skip header row
                    accountingData.invoices = invoices.slice(1).map((row, index) => ({
                        id: row[0] || `INV-${String(index + 1).padStart(3, '0')}`,
                        client: row[1] || '',
                        date: row[2] || '',
                        dueDate: row[3] || '',
                        amount: parseFloat(row[4]) || 0,
                        status: row[5] || 'pending'
                    }));
                }

                if (quotations && quotations.length > 1) {
                    accountingData.quotations = quotations.slice(1).map((row, index) => ({
                        id: row[0] || `QUO-${String(index + 1).padStart(3, '0')}`,
                        client: row[1] || '',
                        date: row[2] || '',
                        validUntil: row[3] || '',
                        amount: parseFloat(row[4]) || 0,
                        status: row[5] || 'pending'
                    }));
                }

                if (expenses && expenses.length > 1) {
                    accountingData.expenses = expenses.slice(1).map((row, index) => ({
                        id: row[0] || `EXP-${String(index + 1).padStart(3, '0')}`,
                        description: row[1] || '',
                        category: row[2] || '',
                        amount: parseFloat(row[3]) || 0,
                        date: row[4] || '',
                        receipt: row[5] === 'true' || row[5] === true
                    }));
                }

                console.log('Data loaded from Google Sheets successfully');
                return true;
            } catch (error) {
                console.error('Failed to load data from Google Sheets:', error);
                return false;
            }
        }

        function syncWithSheets() {
            // Show syncing status
            const statusIndicator = document.querySelector('.google-sheets-status');
            statusIndicator.style.background = '#fef3c7';
            statusIndicator.innerHTML = '<div style="width: 8px; height: 8px; border-radius: 50%; background: #d97706;"></div> Syncing...';
            
            // Attempt to sync with Google Sheets
            loadFromGoogleSheets().then(success => {
                if (success) {
                    statusIndicator.style.background = 'white';
                    statusIndicator.innerHTML = '<div style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div> Synced with Google Sheets';
                    
                    // Refresh current view
                    const activeSection = document.querySelector('.nav-tab.active');
                    if (activeSection) {
                        const sectionName = activeSection.textContent.trim().toLowerCase().split(' ')[0];
                        if (sectionName === 'invoices') loadInvoices();
                        if (sectionName === 'quotations') loadQuotations();
                        if (sectionName === 'expenses') loadExpenses();
                    }
                } else {
                    statusIndicator.style.background = '#fee2e2';
                    statusIndicator.innerHTML = '<div style="width: 8px; height: 8px; border-radius: 50%; background: #dc2626;"></div> Sync Failed - Check Setup';
                }
            }).catch(() => {
                statusIndicator.style.background = 'white';
                statusIndicator.innerHTML = '<div style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div> Using Local Data';
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Simulate initial data sync
            setTimeout(syncWithSheets, 1000);
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        /*
        BYPASS GOOGLE CLOUD CONSOLE - ALTERNATIVE METHODS:
        
        Method 1: Google Apps Script Web App (RECOMMENDED)
        This bypasses Google Cloud Console entirely:
        
        1. Go to script.google.com
        2. Create a new project
        3. Paste this Google Apps Script code:
        
        function doGet(e) {
            const action = e.parameter.action;
            const sheet = SpreadsheetApp.openById('YOUR_SHEET_ID');
            
            if (action === 'getInvoices') {
                const data = sheet.getSheetByName('Invoices').getDataRange().getValues();
                return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
            }
            
            if (action === 'addInvoice') {
                const invoiceSheet = sheet.getSheetByName('Invoices');
                const newRow = [e.parameter.id, e.parameter.client, e.parameter.date, e.parameter.dueDate, e.parameter.amount, e.parameter.status];
                invoiceSheet.appendRow(newRow);
                return ContentService.createTextOutput('Success').setMimeType(ContentService.MimeType.TEXT);
            }
        }
        
        function doPost(e) {
            const data = JSON.parse(e.postData.contents);
            const sheet = SpreadsheetApp.openById('YOUR_SHEET_ID');
            
            if (data.action === 'addQuotation') {
                const quotationSheet = sheet.getSheetByName('Quotations');
                quotationSheet.appendRow([data.id, data.client, data.date, data.validUntil, data.amount, data.status]);
            }
            
            return ContentService.createTextOutput('Success').setMimeType(ContentService.MimeType.JSON);
        }
        
        4. Deploy as Web App with "Anyone" access
        5. Use the Web App URL in your frontend:
        
        async function syncWithSheets() {
            const WEB_APP_URL = 'your-web-app-url';
            
            try {
                // Get data from sheets
                const response = await fetch(`${WEB_APP_URL}?action=getInvoices`);
                const data = await response.json();
                
                // Process data
                accountingData.invoices = processSheetData(data);
                loadInvoices();
                
            } catch (error) {
                console.error('Sync failed:', error);
            }
        }
        
        Method 2: Google Sheets CSV Export (Simple but manual)
        
        async function importFromCSV() {
            // User exports CSV from Google Sheets
            // Upload CSV file through file input
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.csv';
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const data = lines.map(line => line.split(','));
                    // Process CSV data
                    accountingData.invoices = procesCSVData(data);
                    loadInvoices();
                };
                reader.readAsText(file);
            };
            fileInput.click();
        }
        
        Method 3: IFTTT/Zapier Integration
        - Create IFTTT/Zapier webhooks
        - Connect Google Sheets to webhook
        - Send data via webhook when forms are submitted
        
        Method 4: Direct Google Sheets Publish (Read-only)
        1. In Google Sheets: File > Share > Publish to web
        2. Choose CSV format
        3. Use the published URL:
        
        async function loadFromPublishedSheet() {
            const PUBLISHED_URL = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv&gid=0';
            
            try {
                const response = await fetch(PUBLISHED_URL);
                const csvText = await response.text();
                // Parse CSV and update data
                parseCSVData(csvText);
            } catch (error) {
                console.error('Failed to load from published sheet:', error);
            }
        }
        
        RECOMMENDED APPROACH: Use Google Apps Script Web App (Method 1)
        - No Google Cloud Console needed
        - Full read/write access
        - Free and simple setup
        - Works with any Google account
        */
    </script>
</body>
</html>
